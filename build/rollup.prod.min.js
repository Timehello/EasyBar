import resolve from "rollup-plugin-node-resolve";
import uglify from "rollup-plugin-uglify";
import eslint from "rollup-plugin-eslint";
import commonjs from "rollup-plugin-commonjs";
import babel from "rollup-plugin-babel";
import replace from "rollup-plugin-replace";
import postcss from "rollup-plugin-postcss";
import simplevars from "postcss-simple-vars";
import nested from "postcss-nested";
import cssnext from "postcss-cssnext";
import cssnano from "cssnano";
import config from "../config/config.js";

module.exports = {
    input: config.inputFile,
    output: [
        {
            file:
                config.outputPath +
                "/" +
                config.outputBaseFileName +
                ".umd.min.js",
            format: "umd",
            name: config.moduleName
        },
        {
            file:
                config.outputPath +
                "/" +
                config.outputBaseFileName +
                ".browser.min.js",
            format: "iife",
            name: config.moduleName
        },
        {
            file:
                config.outputPath +
                "/" +
                config.outputBaseFileName +
                ".module.min.js",
            format: "es",
            name: config.moduleName
        }
    ],
    plugins: [
        replace({
            ENV: JSON.stringify(process.env.NODE_ENV || "production")
        }),
        postcss({
            plugins: [
                simplevars(),
                nested(),
                cssnext({ warnForDuplicates: false }),
                cssnano()
            ],
            extensions: [".css"]
        }),
        resolve({
            jsnext: true,
            main: true,
            browser: true
        }),
        eslint({
            include: [config.srcPath + "/**/*.js"] // 需要检查的部分
        }),
        commonjs(),
        babel({
            exclude: "node_modules/**"
        }),
        uglify({
            sourceMap: true,
            mangle: true
        })
    ]
};
